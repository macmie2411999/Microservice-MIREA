{
    "$schema": "https://www.krakend.io/schema/v3.json",
    "version": 3,
    "endpoints": [
        {
            "endpoint": "/v1/staffmembers",
            "method": "GET",
            "backend": [{
                "url_pattern": "/v1/staffmembers",
                "method": "GET",
                "host": ["http://staffmembers"],
                "is_collection": true,
                "mapping": {
                    "collection": "staffMembersList"
                }
            }],
            "extra_config": {
                "auth/validator": {
                  "alg": "HS256",
                  "roles": ["user", "admin"],
                  "roles_key": "roles",
                  "jwk_local_path": "jwk_private_key.json",
                  "disable_jwk_security": true,
                  "operation_debug": true
                }
            }
        },
        {
            "endpoint": "/v1/staffmembers",
            "method": "POST",
            "backend": [{
                "url_pattern": "/v1/staffmembers",
                "method": "POST",
                "host": ["http://staffmembers"]
            }]
        },
        {
            "endpoint": "/v1/staffmembers/{idStaffMember}",
            "method": "GET",
            "output_encoding": "no-op",
            "backend": [{
                "encoding": "no-op",
                "url_pattern": "/v1/staffmembers/{idStaffMember}",
                "method": "GET",
                "host": ["http://staffmembers"]
            }]
        },
         {
            "endpoint": "/v1/login",
            "method":  "POST",
            "backend": [
              {
                "url_pattern": "/api/login",
                "encoding": "safejson",
                "host": [
                    "http://auth_s:8000"
                ]
              }
            ],
            "extra_config": {
              "auth/signer": {
                "alg": "HS256",
                "jwk_local_path": "jwk_private_key.json",
                "keys_to_sign": ["access_token"],
                "disable_jwk_security": true,
                "full": false,
                "kid": "sim2"
              }
            }
          }    ,
        {
            "endpoint": "/v1/data",
            "method": "GET",
            "backend": [
                {
                    "url_pattern": "/v1/staffmembers",
                    "method": "GET",
                    "host": ["http://staffmembers"],
                    "is_collection": true,
                    "mapping": {
                        "collection": "staffMembersList"
                    }
                },
                                {
                    "url_pattern": "/v1/products",
                    "method": "GET",
                    "host": ["http://products"],
                    "is_collection": true,
                    "mapping": {
                        "collection": "productsList"
                    }
                }
            ]
        }
    ],
    "extra_config": {
        "router": {
          "return_error_msg": false
        },
        "security/cors": {
          "allow_origins": ["*"],
          "allow_methods": ["POST", "GET"],
          "allow_headers": ["Origin", "Authorization", "Content-Type"],
          "expose_headers": ["Content-Length"],
          "max_age": "12h"
        },
        "telemetry/opencensus": {
            "sample_rate": 100,
            "reporting_period": 0,
            "exporters": {
                "jaeger": {
                  "endpoint": "http://jaeger:14268/api/traces",
                  "service_name":"krakend",
                  "buffer_max_count": 1000
                },
                "prometheus": {
                    "port": 9091,
                    "namespace": "krakend",
                    "tag_host": false,
                    "tag_path": true,
                    "tag_method": true,
                    "tag_statuscode": false
                }
            }
        }
    }
}
